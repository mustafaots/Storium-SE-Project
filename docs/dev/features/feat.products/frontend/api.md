# Products API

## Purpose
HTTP communication layer. Makes requests to the backend API and handles responses.

## File Location
`frontend/src/utils/productsAPI.js`

## API Methods

### getAll(page, limit, search)

Fetches products with pagination and search.

**Input Data Types:**
```javascript
page: number = 1          // 1-based page number
limit: number = 10        // Items per page
search: string = ""       // Search query
```

**HTTP Request:**
```
GET /api/products?page=1&limit=10&search=laptop
Host: localhost:3001
Content-Type: application/json
```

**Query Parameters (encoded in URL):**
```javascript
{
  page: string,           // Converted to string in URL
  limit: string,
  search: string
}
```

**Response Status:** `200 OK`

**Response Data Types:**
```javascript
{
  success: boolean,
  message: string,
  data: Array<{
    product_id: number,
    name: string,
    category: string,
    description: string | null,
    unit: string,
    rate: number,                    // Decimal(10,2)
    rate_unit: string,
    image_data: string | null,       // Base64 encoded
    image_mime_type: string | null,
    min_stock_level: number,
    max_stock_level: number,
    total_stock: number,
    supplier: string | null,
    created_at: string               // ISO 8601 timestamp
  }>,
  pagination: {
    page: number,
    limit: number,
    total: number,
    pages: number
  }
}
```

**Error Response:** `400 | 500`
```javascript
{
  success: false,
  message: string,
  error: string | undefined
}
```

**Implementation:**
```javascript
export const productsAPI = {
  getAll: async (page = 1, limit = 10, search = '') => {
    const response = await api.get('/products', {
      params: { page, limit, search }
    })
    return response.data
  }
}
```

---

### getById(id)

Fetches a single product.

**Input Data Types:**
```javascript
id: number | string  // Product ID
```

**HTTP Request:**
```
GET /api/products/5
```

**Response Status:** `200 OK`

**Response Data Types:**
```javascript
{
  success: boolean,
  message: string,
  data: {
    product_id: number,
    name: string,
    category: string,
    description: string | null,
    unit: string,
    rate: number,
    rate_unit: string,
    image_data: string | null,
    image_mime_type: string | null,
    min_stock_level: number,
    max_stock_level: number,
    total_stock: number,
    supplier: string | null,
    created_at: string
  }
}
```

**Possible Errors:**
- `404 Not Found` - Product doesn't exist
- `500 Internal Server Error` - Database error

---

### create(formData)

Creates a new product with optional image upload.

**Input Data Types:**
```javascript
formData = FormData {
  name: string,
  category: string,
  description: string,
  unit: string,
  rate: string,              // String representation of number
  rate_unit: string,
  min_stock_level: string,
  max_stock_level: string,
  image: File | undefined    // Binary file data
}
```

**HTTP Request:**
```
POST /api/products
Host: localhost:3001
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary...

------WebKitFormBoundary...
Content-Disposition: form-data; name="name"

Laptop Pro
------WebKitFormBoundary...
Content-Disposition: form-data; name="rate"

999.99
------WebKitFormBoundary...
Content-Disposition: form-data; name="image"; filename="laptop.jpg"
Content-Type: image/jpeg

[Binary image data...]
------WebKitFormBoundary...--
```

**Response Status:** `201 Created`

**Response Data Types:**
```javascript
{
  success: boolean,
  message: string,
  data: {
    product_id: number,        // Generated by server
    name: string,
    category: string,
    unit: string,
    rate: number,
    rate_unit: string,
    created_at: string
  }
}
```

**Possible Errors:**
- `400 Bad Request` - Validation error (missing fields, invalid file)
- `413 Payload Too Large` - File exceeds 5MB
- `500 Internal Server Error` - Database error

**Implementation:**
```javascript
create: async (formData) => {
  const response = await api.post('/products', formData, {
    headers: { 'Content-Type': 'multipart/form-data' }
  })
  return response.data
}
```

---

### update(id, formData)

Updates an existing product.

**Input Data Types:**
```javascript
id: number | string

formData = FormData {
  name: string | undefined,
  category: string | undefined,
  description: string | undefined,
  unit: string | undefined,
  rate: string | undefined,
  rate_unit: string | undefined,
  min_stock_level: string | undefined,
  max_stock_level: string | undefined,
  image: File | undefined        // Optional replacement image
}
```

**HTTP Request:**
```
PUT /api/products/5
Content-Type: multipart/form-data
```

**Response Status:** `200 OK`

**Response Data Types:**
```javascript
{
  success: boolean,
  message: string,
  data: {
    product_id: number,
    name: string,
    category: string,
    unit: string,
    rate: number,
    rate_unit: string,
    total_stock: number,
    updated_at: string
  }
}
```

**Possible Errors:**
- `404 Not Found` - Product doesn't exist
- `400 Bad Request` - Validation error
- `500 Internal Server Error` - Database error

---

### delete(id)

Deletes a product.

**Input Data Types:**
```javascript
id: number | string
```

**HTTP Request:**
```
DELETE /api/products/5
```

**Response Status:** `200 OK`

**Response Data Types:**
```javascript
{
  success: boolean,
  message: string,
  data: {
    product_id: number,
    name: string,
    deleted: boolean
  }
}
```

**Possible Errors:**
- `404 Not Found` - Product doesn't exist
- `500 Internal Server Error` - Database error

---

## Axios Configuration

```javascript
// Base API instance
const api = axios.create({
  baseURL: 'http://localhost:3001/api',
  timeout: 5000,
  withCredentials: true
})

// Interceptors
api.interceptors.request.use(config => {
  // Add authorization header if token exists
  const token = localStorage.getItem('authToken')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

api.interceptors.response.use(
  response => response,
  error => {
    // Handle common errors
    if (error.response?.status === 401) {
      // Redirect to login
    }
    throw error
  }
)
```

---

## Error Handling

```javascript
// All API methods handle errors
try {
  const response = await api.get('/products')
  return response.data
} catch (error) {
  // Axios error structure
  error = {
    message: string,                    // "Network Error" or similar
    response: {
      status: number,                   // HTTP status code
      statusText: string,               // "Not Found", "Bad Request"
      data: {
        success: boolean,
        message: string,                // Backend error message
        error: string | undefined
      }
    },
    config: AxiosRequestConfig,
    request: XMLHttpRequest
  }
  
  throw error
}
```

---

## HTTP Status Codes

```javascript
{
  200: "OK - Request successful",
  201: "Created - Resource created",
  400: "Bad Request - Invalid input",
  404: "Not Found - Resource doesn't exist",
  413: "Payload Too Large - File too big",
  500: "Internal Server Error",
  503: "Service Unavailable"
}
```

---

## Content-Type Headers

```javascript
// GET requests (automatic)
Content-Type: application/json

// POST with JSON
Content-Type: application/json

// POST with FormData (automatic with Axios)
Content-Type: multipart/form-data; boundary=...

// The boundary is automatically generated by the browser
```

---

## Type Definitions

```typescript
interface Product {
  product_id: number;
  name: string;
  category: string;
  description: string | null;
  unit: string;
  rate: number;
  rate_unit: string;
  image_data: string | null;
  image_mime_type: string | null;
  min_stock_level: number;
  max_stock_level: number;
  total_stock: number;
  supplier: string | null;
  created_at: string;
}

interface ApiResponse<T> {
  success: boolean;
  message: string;
  data: T;
  error?: string;
}

interface GetAllResponse {
  data: Product[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    pages: number;
  };
}

interface ProductsAPI {
  getAll: (page?: number, limit?: number, search?: string) => Promise<GetAllResponse>;
  getById: (id: number | string) => Promise<ApiResponse<Product>>;
  create: (formData: FormData) => Promise<ApiResponse<Partial<Product>>>;
  update: (id: number, formData: FormData) => Promise<ApiResponse<Product>>;
  delete: (id: number | string) => Promise<ApiResponse<{ product_id: number; deleted: boolean }>>;
}
```

---

## Network Flow

```
Frontend (ProductForm)
  ↓
formData = new FormData()
formData.append('name', 'Laptop')
formData.append('image', fileInput.files[0])
  ↓
productsAPI.create(formData)
  ↓
axios.post('/products', formData, headers)
  ↓
Browser encodes FormData with multipart/form-data
  ↓
HTTP POST to /api/products
  ↓
Backend receives
  ↓
Multer extracts file and form fields
  ↓
Converts image to Base64
  ↓
Inserts into database
  ↓
Returns 201 Created with product_id
  ↓
Frontend receives response
  ↓
Show success toast
  ↓
Reload products list
```

---

## Dependencies
- `axios` - HTTP client
- Uses base API instance configured in `config/api.js`
